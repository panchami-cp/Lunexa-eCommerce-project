<%- include("../partials/user/header")%>
<head>
    <link rel="stylesheet" href="/css/user/signup.css">
</head>

  <section class="auth-wrapper">
    <div class="auth-card login-card">
      <div class="auth-header">SIGNUP</div>
      <form action="/signup" method="POST" class="auth-form" id="signup_form">
        
        <div class="auth-field">
          <input type="text" placeholder="Fullname" class="auth-input" id="fullname" name="fullname">
          <div class="invalid-feedback" id="name_error"></div>
        </div>

        <div class="auth-field">
          <input type="email" placeholder="Email" class="auth-input" id="email" name="email">
          <div class="invalid-feedback" id="email_error"></div>
        </div>

        <div class="auth-field">
          <input type="password" placeholder="Password" class="auth-password" id="password" name="password">
          <i class='bx bx-hide toggle-visibility'></i>
          <div class="invalid-feedback" id="password_error"></div>
        </div>

        <div class="auth-field">
          <input type="password" placeholder="Confirm Password" class="auth-password" id="confirm_password" name="confirm_password">
          <i class='bx bx-hide toggle-visibility'></i>
          <div class="invalid-feedback" id="confirm_password_error"></div>
        </div>

        <div class="auth-field">
          <input type="text" placeholder="Enter your referral code here (if got any)" class="auth-password" id="referralCode" name="referralCode">
          <i class='bx bx-hide toggle-visibility'></i>
          <div class="invalid-feedback" id="referral_code_error"></div>
        </div>

<% if (message) { %>
  <div class="text-danger"><%= message %></div>
<% } %>
        <div class="auth-button-group">
          <button type="submit" class="auth-submit" style="background-color: black;">CREATE</button>
        </div>
      </form>

      <div class="auth-footer center-align">
        <span>Already have an account? <a href="/login" class="switch-auth switch-to-signup">Signin</a></span>
      </div>

      <div class="separator"></div>
      <div class="social-login">
        <a href="/auth/google" class="social-button google-button">
          <img src="https://cdn1.iconfinder.com/data/icons/google-s-logo/150/Google_Icons-09-512.png" alt="Google Logo" class="google-icon">
          <span>Signup with Google</span>
        </a>
      </div>
    </div>
  </section>

  <script>
    const fullname = document.getElementById('fullname');
    const email = document.getElementById('email');
    const password = document.getElementById('password');
    const confirmPassword = document.getElementById('confirm_password');
    const referralCode = document.getElementById('referralCode')

    const nameError = document.getElementById('name_error');
    const emailError = document.getElementById('email_error');
    const passwordError = document.getElementById('password_error');
    const confirmPasswordError = document.getElementById('confirm_password_error');

    function setInvalid(field, errorDiv, message) {
      field.classList.add('is-invalid');
      errorDiv.style.display = 'block';
      errorDiv.innerText = message;
    }

    function clearInvalid(field, errorDiv) {
      field.classList.remove('is-invalid');
      errorDiv.style.display = 'none';
      errorDiv.innerText = '';
    }

    function nameValidation() {
      const nameValue = fullname.value.trim();
      const namePattern = /^[a-zA-Z]+([ '-][a-zA-Z]+)*$/;

      if (!nameValue) {
        setInvalid(fullname, nameError, 'This field is required');
      } else if (!namePattern.test(nameValue)) {
        setInvalid(fullname, nameError, 'Enter a valid name');
      } else {
        clearInvalid(fullname, nameError);
      }
    }

    function emailValidation() {
      const emailValue = email.value.trim();
      const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

      if (!emailValue) {
        setInvalid(email, emailError, 'This field is required');
      } else if (!emailPattern.test(emailValue)) {
        setInvalid(email, emailError, 'Enter a valid email ID');
      } else {
        clearInvalid(email, emailError);
      }
    }

    function passwordValidation() {
      const passwordValue = password.value.trim();
      const passwordPattern = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z\d])[A-Za-z\d\S]{8,}$/;

      if (!passwordValue) {
        setInvalid(password, passwordError, 'This field is required');
      } else if (passwordValue.length < 8) {
        setInvalid(password, passwordError, 'Password must be at least 8 characters long');
      } else if (!passwordPattern.test(passwordValue)) {
        setInvalid(password, passwordError, 'Must include uppercase, lowercase, number & special char');
      } else {
        clearInvalid(password, passwordError);
      }
    }

    function confirmPasswordValidation() {
      const cPasswordValue = confirmPassword.value.trim();

      if (!cPasswordValue) {
        setInvalid(confirmPassword, confirmPasswordError, 'This field is required');
      } else if (cPasswordValue !== password.value.trim()) {
        setInvalid(confirmPassword, confirmPasswordError, 'Passwords do not match');
      } else {
        clearInvalid(confirmPassword, confirmPasswordError);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('signup_form').addEventListener('submit', function(event) {
        nameValidation();
        emailValidation();
        passwordValidation();
        confirmPasswordValidation();

        if (
          nameError.innerText ||
          emailError.innerText ||
          passwordError.innerText ||
          confirmPasswordError.innerText
        ) {
          event.preventDefault();
        }
      });
    });
  </script>
<!-- footer -->
<%- include("../partials/user/footer")%>
   <script src="js/jquery.min.js"></script>
   <script src="js/plugins.js"></script>
   <script src="js/SmoothScroll.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
     integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
     crossorigin="anonymous"></script>
   <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
   <script src="js/script.min.js"></script>
 </body>
 
 </html>
