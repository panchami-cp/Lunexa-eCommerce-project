<%- include("../partials/user/header")%>



<div class="container mt-5" style="margin-bottom: 10rem;">
  <div class="mb-4">
    <h4>Edit Address</h4>
  </div>

  <form action="/edit_address?id=<%=address._id%>" method="POST" id="addressForm">
    <div class="row mb-3">
     
      <div class="col-md-4">
        <label class="form-label">Name:</label>
        <input type="text" name="name" class="form-control" id="name" value="<%=address.name%>"/>
        <div class="invalid-feedback">Empty/Invalid name</div>
      </div>
       <div class="col-md-4">
        <label class="form-label">House/Building:</label>
        <input type="text" name="building" class="form-control" id="building" value="<%=address.building%>"/>
        <div class="invalid-feedback">Empty/Invalid building name</div>
      </div>
      <div class="col-md-4">
        <label class="form-label">Area/Street:</label>
        <input type="text" name="area" class="form-control" id="area" value="<%=address.area%>"/>
        <div class="invalid-feedback">Empty/Invalid area</div>
      </div>
      
    </div>

    <div class="row mb-3">
      
      <div class="col-md-4">
        <label class="form-label">Landmark:</label>
        <input type="text" name="landmark" class="form-control" id="landmark" value="<%=address.landmark%>"/>
        <div class="invalid-feedback">Empty/Invalid landmark</div>
      </div>
      <div class="col-md-4">
        <label class="form-label">City:</label>
        <input type="text" name="city" class="form-control" id="city" value="<%=address.city%>"/>
        <div class="invalid-feedback">Empty/Invalid city</div>
      </div>
      <div class="col-md-4">
        <label class="form-label">State:</label>
        <input type="text" name="state" class="form-control" id="state" value="<%=address.state%>"/>
        <div class="invalid-feedback">Empty/Invalid state</div>
      </div>
      
    </div>

    <div class="row mb-4">
      <div class="col-md-4">
        <label class="form-label">Pincode:</label>
        <input type="text" name="pincode" class="form-control" id="pincode" value="<%=address.pincode%>"/>
        <div class="invalid-feedback">Empty/Invalid pincode</div>
      </div>
      <div class="col-md-4">
        <label class="form-label">Phone:</label>
        <input type="tel" name="phone" class="form-control"  id="phone" value="<%=address.phone%>"/>
        <div class="invalid-feedback">Empty/Invalid phone number</div>
      </div>
      <div class="col-md-4">
        <label class="form-label">Alternate Phone:</label>
        <input type="tel" name="alternatePhone" class="form-control" id="alternatePhone" value="<%=address.alternatePhone%>"/>
        <div class="invalid-feedback">Invalid/same phone number</div>
      </div>
    </div>
    <div id="error_message" class="text-danger" style="font-size: 1rem;"></div>
    <button type="submit" class="btn submit-btn btn-dark">Submit</button>
  </form>
</div>


<!-- form validation -->

<script>
  document.getElementById('addressForm').addEventListener('submit', function(event) {
    event.preventDefault(); 

    const form = event.target

    let isValid = true;

    const fieldsToValidate = ['name','building','area',  'landmark','city', 'state', 'pincode', 'phone'];

    const namePatternFields = ['name','building','area','landmark', 'city',  'state']

    
    const pincode = document.getElementById('pincode').value
    const phone = document.getElementById('phone').value
    const alternatePhone = document.getElementById('alternatePhone').value

    const namePattern = /^[A-Za-z\s]+$/
    const pincodePattern = /^\d{6}$/
    const phonePattern = /^\d{10}$/

    // const globalError = document.getElementById('error_message')
    // globalError.style.display = 'none'
    // globalError.innerText = ""

    fieldsToValidate.forEach(field => {
      const input = document.getElementById(field);
      if (!input.value.trim()) {
        input.classList.add('is-invalid');
        // document.getElementById('error_message').style.display = "block"
        // document.getElementById('error_message').innerHTML = "Fill out the fields"
        isValid = false;

      } else {
        input.classList.remove('is-invalid'); 
        //  document.getElementById('error_message').style.display = "none"
        //  document.getElementById('error_message').innerHTML = ""
      }
    });

    namePatternFields.forEach(field =>{
        const value = document.getElementById(field).value

        if(!namePattern.test(value.trim())){
            document.getElementById(field).classList.add('is-invalid')
            isValid = false
        } else{
            document.getElementById(field).classList.remove('is-invalid')
        }

    })

    if(!pincodePattern.test(pincode)){
        document.getElementById('pincode').classList.add('is-invalid')
        isValid = false
    }

    if(!phonePattern.test(phone)){
        document.getElementById('phone').classList.add('is-invalid')
        isValid = false
    }

    if(alternatePhone && !phonePattern.test(alternatePhone)){
        document.getElementById('alternatePhone').classList.add('is-invalid')
        isValid = false
    }

    if(phone && alternatePhone && phone === alternatePhone){

       document.getElementById('alternatePhone').classList.add('is-invalid');
       globalError.style.display = 'block';
       globalError.innerText = "Phone and Alternate Phone should not be the same.";
       isValid = false;

    }

    // if (!isValid) {
    //     globalError.style.display = 'block';
    //     if (!globalError.innerText) {
    //         globalError.innerText = "Please fix the errors above.";
    //     }
    //     return;
    // }


    if(isValid){
        form.submit();
    }
    
      
    
  });
</script>



<%- include("../partials/user/footer")%>
   <script src="js/jquery.min.js"></script>
   <script src="js/plugins.js"></script>
   <script src="js/SmoothScroll.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
     integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
     crossorigin="anonymous"></script>
   <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
   <script src="js/script.min.js"></script>
 </body>
 
 </html>