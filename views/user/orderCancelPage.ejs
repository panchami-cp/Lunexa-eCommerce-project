<%- include("../partials/user/header") %>

<head>
    <link rel="stylesheet" href="/css/user/orderCancelPage.css">
</head>

<div class="cancel-order-container">
    <!-- Order ID -->
    <div class="order-header">
        <h5>Order ID: <%= order.orderId %></h5>
        
    </div>

    <form action="/cancel_order" method="POST" id="cancelOrderForm">
        <input type="hidden" name="itemId" value="<%= item._id %>" id="itemId">
        
        <!-- Big Box for Products -->
        <div class="products-box">
                <div class="order-item">
                    <!-- Product Image -->
                    <img src="/uploads/re-product-image/<%= item.productId.productImage[0] %>" 
                         alt="<%= item.productId.productName %>" 
                         class="product-image">

                    <!-- Product Details -->
                    <div class="product-details">
                        <h4 class="text-capitalize"><%= item.productId.productName %></h4>
                        <p>Size: <%= item.size %></p>
                        <p>Price: â‚¹<%= item.price %></p>
                        <p>Quantity: <%= item.quantity %></p>

                    </div>
                </div>
        </div>

        <!-- Common Cancel Button -->
        <div class="cancel-btn-container">
            <div id="errorMassage" class="text-danger"></div>
            <button type="submit" class="cancel-btn"  id="cancelBtn">Cancel</button>
        </div>
    </form>
</div>

<!-- confirmation modal -->

<div id="confirmModal" class="modal">
    <div class="modal-content">
        <p>Are you sure you want to cancel the product?</p>
        <div class="modal-actions">
            <button type="button" id="confirmYes">Yes</button>
            <button type="button" id="confirmNo">No</button>
        </div>
    </div>
</div>

<script>
document.getElementById("cancelBtn").addEventListener("click", function(event) {
    event.preventDefault()

    document.getElementById("confirmModal").style.display = "flex"
});

document.getElementById("confirmYes").addEventListener("click", async function() {
    const form = document.getElementById("cancelOrderForm")

    const itemId = document.getElementById('itemId').value
    console.log("item id:", itemId)

    try {
        const res = await fetch(form.action, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({itemId})
        });

        const data = await res.json();

        if (data.success) {
            window.location.href = '/orders'
           
        } else {
            window.location.href = data.redirectUrl;
        }
    } catch (err) {
        console.error("Error cancelling order:", err);
        window.location.href = data.redirectUrl
    }

    document.getElementById("confirmModal").style.display = "none";
});


function showPopup(message, type) {
    const popup = document.createElement('div')
    popup.textContent = message
    popup.style.position = 'fixed'
    popup.style.top = '20px'
    popup.style.left = '20px'
    popup.style.padding = '12px 20px'
    popup.style.borderRadius = '5px'
    popup.style.color = '#fff'
    popup.style.zIndex = '9999'
    popup.style.backgroundColor = '#000'
    popup.style.boxShadow = '0 2px 6px rgba(0,0,0,0.2)'
    document.body.appendChild(popup)

    setTimeout(() => {
      popup.remove()
    }, 2000)
  }
</script>

<!-- Footer -->
<%- include("../partials/user/footer") %>

<script src="js/jquery.min.js"></script>
<script src="js/plugins.js"></script>
<script src="js/SmoothScroll.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
  crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
<script src="js/script.min.js"></script>

</body>
</html>