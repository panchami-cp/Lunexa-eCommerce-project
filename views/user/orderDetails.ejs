<%- include("../partials/user/header") %>

<head>
  <link rel="stylesheet" href="/css/user/orderDetails.css">
</head>


<div class="container-fluid">
    <div class="container-fluid">
  <div class="order-details-box">

    <!-- Top Row: Image + Info -->
     
    <div class="d-flex">
        
      <img src="/uploads/re-product-image/<%= item.productId.productImage[0] %>" 
           alt="<%=item.productId.productName%>" 
           class="product-image me-3">
            
    </div>
       
    <div class="top-row mt-3">
     

      <div class="order-info">
        <div class="order-id"><strong>Order ID:</strong> <%=order.orderId%></div>
        <div class="delivery-date">
          Delivery Date: 
          <br>
          <%if(item.orderStatus === 'Placed' || item.orderStatus === 'Processing' || item.orderStatus === 'Shipped' || item.orderStatus === 'Out for delivery' || item.orderStatus === 'Delivered'){%>
          <a href="/download_invoice?id=<%=order._id%>" class="btn btn-sm btn-outline-secondary">Download Invoice</a>
          <%}%>
        </div>
      </div>
    </div>

    <!-- Status Tracking -->
   <div class="order-progress">
    <% 
        const steps = ["Placed", "Shipped", "Out for Delivery", "Delivered"];
        const currentIndex = steps.indexOf(item.orderStatus);
    %>
    <% steps.forEach((step, index) => { %>
        <div class="progress-step-container <%= index <= currentIndex ? 'completed' : '' %>">
            <div class="progress-step <%= index <= currentIndex ? 'completed' : '' %>">
                <!-- <% if (index <= currentIndex) { %>
                    <span class="checkmark">&#10003;</span>
                <% } %> -->
            </div>
            <div class="step-label"><%= step %></div>
        </div>
    <% }) %>
</div>



    <!-- Action Buttons -->
    <div class="order-actions">
      <%if(item.orderStatus === 'Pending' || item.orderStatus === 'Placed' || item.orderStatus === 'Processing'){%>
    <a href="/cancel_order?id=<%=item._id%>" class="btn btn-danger">Cancel Order</a>
    <%}%>
      <% if (item.orderStatus === 'Delivered' && (!item.returnRequest || !item.returnRequest.status)) { %>
    
        <a href="/return_order?id=<%=item._id%>" class="btn btn-danger">Return</a>
    
        
    <% } %>

      
    </div>

  </div>
</div>
</div>



<!-- Footer -->
<%- include("../partials/user/footer") %>

<script src="js/jquery.min.js"></script>
<script src="js/plugins.js"></script>
<script src="js/SmoothScroll.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
  crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
<script src="js/script.min.js"></script>

</body>
</html>